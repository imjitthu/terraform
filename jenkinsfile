pipeline {

    agent any

    parameters {
    choice(name: 'tfaction', choices: ['init', 'plan', 'validate', 'apply', 'destroy'], description: 'Pick any action')
               }

    stages {
        stage ('Creating infra for RoboShop') {
            steps {
                script {
                    if (params.tfaction == 'init') {
                    sh "terraform ${params.tfaction}"
                    } 
                    if (params.tfaction == 'plan') {
                    sh "terraform plan" 
                    } 
                    if (params.tfaction == 'apply') {
                    sh "terraform apply -auto-approve"
                    sh "git clone https://github.com/imjitthu/Ansible.git"
                    sh "pwd; ls"
                    ansiblePlaybook credentialsId: 'DevOps321', installation: 'ansibletool', inventory: '/tmp/inv.txt', playbook: 'ansible/roboshop.yml' 
                    } 
                    if (params.tfaction == 'destroy') {
                    sh "terraform destroy -auto-approve"   
                    }
                    if (params.tfaction == 'validate') {
                    sh "terraform validate"   
                    }                         
                    }
                    }
                  }
                }
            }