pipeline { //pipeline

    agent any
    options { disableConcurrentBuilds() }

    tools {
    ansible 'ansibletool'
    }

    stages ('Setup Roboshop Application') { //stages
        stage ('Setup Frontend, MySql, Redis, and RabbitMQ-Server') { //stage
        parallel { //parallel 1
            stage ('Setup Frontend Server') { //mongo stage
                steps { //mongo steps
                echo 'Installing Frontend'
                withCredentials([aws(accessKeyVariable: 'AWS_ACCESS_KEY_ID', credentialsId: 'awskey', secretKeyVariable: 'AWS_SECRET_ACCESS_KEY')]) {
                     echo 'Downloading from GITHub'
                     git 'https://github.com/imjitthu/terraform.git'
                     sh'''
                         echo 'installing frontend server'
                         cd roles/frontend
                         terraform init
                         terraform apply -auto-approve
                         sleep 3s
                     '''
                     }
                } //mongo steps
            }
            stage ('Setup MySql Server') { //mysql stage
                steps { //mysql steps
                echo 'installing redis'
                // withCredentials([aws(accessKeyVariable: 'AWS_ACCESS_KEY_ID', credentialsId: 'awskey', secretKeyVariable: 'AWS_SECRET_ACCESS_KEY')]) {
                //     echo 'AWS Credentials'
                //     echo 'Downloading from GITHub'
                //     git 'https://github.com/imjitthu/terraform.git'
                //     sh'''
                //         echo 'installing mysql server'
                //         cd roboshop/mysql
                //         terraform init
                //         terraform apply -auto-approve
                //         sleep 3s
                //     '''                } 
                } //mysql steps
            } //mysql stage
            stage ('Setup Redis Server') { //redis stage
                steps { //redis steps
                echo 'installing redis'
                } //redis steps
            }
            stage ('Setup RabbitMQ Server') { //rabbitmq stage
                steps { //rabbitmq steps
                echo 'installing rabbitmq'
                } //rabbitmq steps
            } //rabbitmq stage
    } //parallel 1 
  } //stage
} //stages
} //pipeline